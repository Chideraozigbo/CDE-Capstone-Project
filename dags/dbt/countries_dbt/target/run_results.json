{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.8", "generated_at": "2024-11-17T07:46:39.794323Z", "invocation_id": "51de45b5-43c9-4e89-aa23-4f8f850c0a6a", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:18.972601Z", "completed_at": "2024-11-17T07:46:18.994349Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:18.994835Z", "completed_at": "2024-11-17T07:46:20.454925Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.9371798038482666, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-65f5-0002-767a000157d6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.stg_country", "compiled": true, "compiled_code": "-- This query extracts raw country information, including demographic, political, and geographical details, from the `country_data` source table.\n-- The dataset includes fields such as country name, independence status, capital, region, population, languages, and currency information.\n\n\nWITH raw_countries AS(\n    SELECT\n        \n    md5(cast(coalesce(cast(country_name as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT))\n as country_id,\n        TRIM(Country_Name) AS country_name,\n        TRIM(independence) AS independence,\n        TRIM(united_nation_members) AS united_nation_members,\n        TRIM(start_of_week) AS start_of_week,\n        TRIM(official_name) AS official_name,\n        TRIM(common_native_name) AS common_native_name,\n        TRIM(currency_code) AS currency_code,\n        TRIM(currency_name) AS currency_name,\n        TRIM(currency_symbol) AS currency_symbol,\n        TRIM(country_code) AS country_code,\n        TRIM(capital) AS capital,\n        TRIM(region) AS region,\n        TRIM(subregion) AS subregion,\n        TRIM(area) AS area,\n        TRIM(population) AS population,\n        TRIM(continents) AS continents\n    from country_database.raw_country_schema.country_data\n)\nSELECT\n    *\nFROM raw_countries", "relation_name": "country_database._staging_schema.stg_country"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:20.917255Z", "completed_at": "2024-11-17T07:46:20.922256Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:20.922716Z", "completed_at": "2024-11-17T07:46:22.273713Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.7786478996276855, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-665e-0002-767a0001a106"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.stg_country_languages", "compiled": true, "compiled_code": "-- This query retrieves a list of languages spoken in each country by flattening \n-- the comma-separated `languages` field from `raw country_data` table. \n-- It uses Snowflake\u2019s `LATERAL FLATTEN` function on the array of languages to create a \n-- row for each language associated with a given `country_code`.\n\nSELECT \n    country_code,\n    TRIM(value) AS language\nFROM country_database.raw_country_schema.country_data,\nLATERAL FLATTEN(input => SPLIT(languages, ', ')) AS language", "relation_name": "country_database._staging_schema.stg_country_languages"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:22.700965Z", "completed_at": "2024-11-17T07:46:22.708333Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:22.708794Z", "completed_at": "2024-11-17T07:46:24.755961Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.482936143875122, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-6976-0002-767a000193a6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.dim_country", "compiled": true, "compiled_code": "\n\nWITH country_base AS (\n    SELECT \n        country_id,\n        country_code,\n        Country_Name,\n        official_name,\n        common_native_name,\n        independence,\n        united_nation_members,\n        capital,\n        region,\n        subregion,\n        continents,\n        start_of_week\n    FROM country_database._staging_schema.stg_country\n)\nSELECT \n    *,\n    current_timestamp() as created_at,\n    'N/A' as record_status\nFROM country_base", "relation_name": "country_database._mart_schema.dim_country"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:25.187840Z", "completed_at": "2024-11-17T07:46:25.193847Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:25.194317Z", "completed_at": "2024-11-17T07:46:27.253086Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.5310840606689453, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-6ac4-0002-767a0001342e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.dim_currency", "compiled": true, "compiled_code": "\nWITH currency_base AS (\n    SELECT DISTINCT currency_code,\n        currency_name,\n        currency_symbol\n    FROM country_database._staging_schema.stg_country\n    WHERE currency_code IS NOT NULL\n)\nSELECT \n    md5(cast(coalesce(cast(currency_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as currency_id,\n    *,\n    current_timestamp() as created_at,\n    'N/A' as record_status\nFROM currency_base", "relation_name": "country_database._mart_schema.dim_currency"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:27.724753Z", "completed_at": "2024-11-17T07:46:27.732761Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:27.733351Z", "completed_at": "2024-11-17T07:46:29.513487Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.176331043243408, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-665e-0002-767a0001a10a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.dim_language", "compiled": true, "compiled_code": "\nWITH language_base AS (\n    SELECT DISTINCT\n        language\n    FROM country_database._staging_schema.stg_country_languages\n    WHERE language IS NOT NULL\n)\nSELECT \n    md5(cast(coalesce(cast(language as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as language_id,\n    language,\n    current_timestamp() as created_at,\n    'N/A' as record_status\nFROM language_base", "relation_name": "country_database._mart_schema.dim_language"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:29.960049Z", "completed_at": "2024-11-17T07:46:29.999182Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:29.999883Z", "completed_at": "2024-11-17T07:46:31.757450Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.193511962890625, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-6976-0002-767a000193aa"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.bridge_country_languages", "compiled": true, "compiled_code": "\nWITH exploded_languages AS (\n    -- Get country codes and exploded languages from the staging table\n    SELECT \n        c.country_code,\n        l.language\n    FROM \n        country_database._staging_schema.stg_country c\n    JOIN \n        country_database._staging_schema.stg_country_languages l\n    ON c.country_code = l.country_code\n),\n\nmapped_ids AS (\n    -- Map the exploded data to their respective surrogate keys\n    SELECT\n        d.country_id,\n        dl.language_id\n    FROM \n        exploded_languages el\n    LEFT JOIN country_database._mart_schema.dim_country d \n    ON el.country_code = d.country_code\n    LEFT JOIN country_database._mart_schema.dim_language dl \n    ON el.language = dl.language\n),\n\ndeduplicated_bridge AS (\n    -- Ensure no duplicates in the bridge table\n    SELECT DISTINCT\n        country_id,\n        language_id\n    FROM mapped_ids\n)\n\n-- Final output\nSELECT \n    country_id,\n    language_id\nFROM \n    deduplicated_bridge", "relation_name": "country_database._mart_schema.bridge_country_languages"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:32.159804Z", "completed_at": "2024-11-17T07:46:32.167039Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:32.167593Z", "completed_at": "2024-11-17T07:46:33.911992Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.2406210899353027, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-6ac4-0002-767a00013432"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.fact_country_metric", "compiled": true, "compiled_code": "WITH country_base AS (\n    SELECT \n        DISTINCT\n        c.country_id,\n        c.country_name,\n        CAST(c.population AS FLOAT) AS population,\n        CAST(c.area AS FLOAT) AS area,\n        c.currency_code,\n        c.region,\n        c.subregion\n    FROM country_database._staging_schema.stg_country c\n    WHERE c.population IS NOT NULL AND c.area IS NOT NULL\n),\n\npopulation_density AS (\n    SELECT \n        cb.country_id,\n        cb.population / NULLIF(cb.area, 0) AS population_density \n    FROM country_base cb\n),\n\ndensity_category AS (\n    SELECT \n        pd.country_id,\n        pd.population_density,\n        CASE \n            WHEN pd.population_density < 50 THEN 'Low Density'\n            WHEN pd.population_density BETWEEN 50 AND 300 THEN 'Medium Density'\n            ELSE 'High Density'\n        END AS density_category\n    FROM population_density pd\n),\n\nlanguage_diversity AS (\n    SELECT \n        bcl.country_id,\n        COUNT(DISTINCT bcl.language_id) AS language_count\n    FROM country_database._mart_schema.bridge_country_languages bcl\n    GROUP BY bcl.country_id\n),\n\ncurrency_mapping AS (\n    SELECT DISTINCT\n        cb.country_id,\n        dc.currency_id\n    FROM country_base cb\n    LEFT JOIN country_database._mart_schema.dim_currency dc\n    ON cb.currency_code = dc.currency_code\n),\n\nfact_metrics AS (\n    SELECT DISTINCT\n        cb.country_id,\n        cb.population,\n        cb.area,\n        cm.currency_id,\n        dc.population_density,\n        dc.density_category,\n        ld.language_count,\n        CASE \n            WHEN ld.language_count = 1 THEN 'Monolingual'\n            WHEN ld.language_count BETWEEN 2 AND 4 THEN 'Moderately Multilingual'\n            ELSE 'Highly Multilingual'\n        END AS language_diversity_category\n    FROM country_base cb\n    LEFT JOIN density_category dc ON cb.country_id = dc.country_id\n    LEFT JOIN language_diversity ld ON cb.country_id = ld.country_id\n    LEFT JOIN currency_mapping cm ON cb.country_id = cm.country_id\n)\n\nSELECT \n    DISTINCT *, \n    current_timestamp() AS created_at,\n    'N/A' AS record_status\nFROM fact_metrics", "relation_name": "country_database._mart_schema.fact_country_metric"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:34.404861Z", "completed_at": "2024-11-17T07:46:34.410498Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:34.410844Z", "completed_at": "2024-11-17T07:46:35.784670Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.828679084777832, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-6976-0002-767a000193ae"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.language_by_country_analysis", "compiled": true, "compiled_code": "\n\nSELECT\n    l.language,\n    COUNT(DISTINCT f.country_id) AS country_count,\n    SUM(f.population) AS total_population,\n    AVG(f.population_density) AS avg_population_density\nFROM country_database._mart_schema.bridge_country_languages b\nJOIN country_database._mart_schema.dim_language l\n    ON b.language_id = l.language_id\nJOIN country_database._mart_schema.fact_country_metric f\n    ON b.country_id = f.country_id\nGROUP BY l.language", "relation_name": "country_database._analytical_schema.language_by_country_analysis"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:36.240835Z", "completed_at": "2024-11-17T07:46:36.247331Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:36.247788Z", "completed_at": "2024-11-17T07:46:37.629434Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.8435299396514893, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-6976-0002-767a000193b2"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.population_language_analysis", "compiled": true, "compiled_code": "\n\nSELECT \n    d.country_name,\n    f.population,\n    f.area,\n    f.population_density,\n    f.density_category,\n    f.language_count,\n    f.language_diversity_category,\n    d.region,\n    d.subregion,\n    c.currency_name,\n    c.currency_symbol\nFROM country_database._mart_schema.fact_country_metric f\nJOIN country_database._mart_schema.dim_country d\n    ON f.country_id = d.country_id\nLEFT JOIN country_database._mart_schema.dim_currency c\n    ON f.currency_id = c.currency_id", "relation_name": "country_database._analytical_schema.population_language_analysis"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-17T07:46:38.091536Z", "completed_at": "2024-11-17T07:46:38.099810Z"}, {"name": "execute", "started_at": "2024-11-17T07:46:38.100315Z", "completed_at": "2024-11-17T07:46:39.394783Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.6959388256072998, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b86d52-0305-65f5-0002-767a000157da"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.countries_dbt.regional_metrics_summary", "compiled": true, "compiled_code": "\n\nSELECT\n    d.region,\n    d.subregion,\n    COUNT(*) AS country_count,\n    SUM(f.population) AS total_population,\n    AVG(f.population_density) AS avg_population_density,\n    MAX(f.population_density) AS max_population_density,\n    AVG(f.language_count) AS avg_language_count,\n    MAX(f.language_count) AS max_language_count\nFROM country_database._mart_schema.fact_country_metric f\nJOIN country_database._mart_schema.dim_country d\n    ON f.country_id = d.country_id\nGROUP BY d.region, d.subregion", "relation_name": "country_database._analytical_schema.regional_metrics_summary"}], "elapsed_time": 33.15151524543762, "args": {"log_level_file": "debug", "indirect_selection": "eager", "partial_parse": true, "send_anonymous_usage_stats": true, "populate_cache": true, "quiet": false, "warn_error_options": {"include": [], "exclude": []}, "version_check": true, "write_json": true, "printer_width": 80, "empty": false, "strict_mode": false, "log_path": "/Users/user/Documents/cde_dbt/cde-project/dags/dbt/countries_dbt/logs", "log_format_file": "debug", "enable_legacy_logger": false, "log_level": "info", "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors": true, "defer": false, "exclude": [], "profiles_dir": "/Users/user/.dbt", "log_format": "default", "vars": {}, "log_file_max_bytes": 10485760, "macro_debugging": false, "invocation_command": "dbt run", "show_resource_report": false, "which": "run", "favor_state": false, "cache_selected_only": false, "use_colors_file": true, "project_dir": "/Users/user/Documents/cde_dbt/cde-project/dags/dbt/countries_dbt", "static_parser": true, "require_resource_names_without_spaces": false, "partial_parse_file_diff": true, "print": true, "introspect": true, "source_freshness_run_project_hooks": false, "select": []}}